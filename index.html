<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tokit1</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
    /* –°—Ç–∏–ª–∏ –æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π */
    body {
        font-family: Arial, sans-serif;
        text-align: center;
        margin: 0;
        padding: 20px;
        background-color: #121212;
        color: #ffffff;
    }

    h2 {
        color: #ffffff;
    }

    .topics {
        display: flex;
        flex-wrap: wrap;
        justify-content: center;
        gap: 10px;
        margin: 20px 0;
    }

    .topic {
        padding: 10px 15px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 16px;
        background-color: #444;
        color: #fff;
        transition: background-color 0.3s, transform 0.2s;
    }

    .topic:hover {
        transform: scale(1.05);
    }

    .selected {
        background-color: #ff5722;
        color: white;
    }

    .video-container {
        display: flex;
        justify-content: center;
        margin: 20px auto;
    }

    #player {
        width: 320px;
        height: 560px;
        border-radius: 15px;
        overflow: hidden;
        background-color: #000;
    }

    .controls {
        margin-top: 10px;
        display: flex;
        justify-content: center;
        gap: 10px;
    }

    .nav-btn {
        padding: 10px 15px;
        border: none;
        border-radius: 20px;
        cursor: pointer;
        font-size: 16px;
        background-color: #333;
        color: #fff;
    }

    .nav-btn:hover {
        background-color: #555;
    }

    .coin-counter {
        font-size: 20px;
        margin-top: 20px;
        color: #ffeb3b;
    }

    .load-btn {
        padding: 12px 24px;
        background-color: #ff5722;
        color: white;
        border: none;
        border-radius: 25px;
        font-size: 16px;
        cursor: pointer;
        margin-bottom: 20px;
    }

    .load-btn:hover {
        background-color: #e64a19;
    }
</style>
</head>
<body>
    <!-- HTML —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π -->
    <h2>–í—ã–±–µ—Ä–∏—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–µ –≤–∞—Å —Ç–µ–º—ã:</h2>
    <div class="topics">
        <button class="topic" onclick="toggleTopic(this)" value="sport">üèãÔ∏è –°–ø–æ—Ä—Ç</button>
        <button class="topic" onclick="toggleTopic(this)" value="games">üéÆ –ò–≥—Ä—ã</button>
        <button class="topic" onclick="toggleTopic(this)" value="music">üéµ –ú—É–∑—ã–∫–∞</button>
        <button class="topic" onclick="toggleTopic(this)" value="entertainment">üé≠ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è</button>
        <button class="topic" onclick="toggleTopic(this)" value="education">üìö –û–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ</button>
        <button class="topic" onclick="toggleTopic(this)" value="tech">üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏</button>
        <button class="topic" onclick="toggleTopic(this)" value="vehicles">üöó –ê–≤—Ç–æ</button>
        <button class="topic" onclick="toggleTopic(this)" value="trip">‚úàÔ∏è –ü—É—Ç–µ—à–µ—Å—Ç–≤–∏—è</button>
        <button class="topic" onclick="toggleTopic(this)" value="food">üçî –ï–¥–∞</button>
        <button class="topic" onclick="toggleTopic(this)" value="health">‚ù§Ô∏è –ó–¥–æ—Ä–æ–≤—å–µ</button>
    </div>
    <button class="load-btn" onclick="loadVideos()">–ü–æ–∫–∞–∑–∞—Ç—å –≤–∏–¥–µ–æ</button>

    <div class="video-container">
        <video id="player" controls></video>
    </div>
    <div class="controls">
        <button class="nav-btn" onclick="prevVideo()">‚Üê –ù–∞–∑–∞–¥</button>
        <button class="nav-btn" onclick="nextVideo()">–í–ø–µ—Ä—ë–¥ ‚Üí</button>
    </div>
    <div class="coin-counter">
      üí∞: <span id="coins">0</span>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        const userId = tg.initDataUnsafe?.user?.id;
        const baseUrl = "https://raw.githubusercontent.com/koganvladislav/tokit/main/";

        // –ú–∞—Å—Å–∏–≤—ã —Å –ø—É—Ç—è–º–∏ –∫ –≤–∏–¥–µ–æ—Ñ–∞–π–ª–∞–º (–æ—Å—Ç–∞—é—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
        const videoPaths = {
            education: [
                "videos/education/video1.mp4", "videos/education/video2.mp4", "videos/education/video3.mp4", "videos/education/video4.mp4",
                "videos/education/video5.mp4", "videos/education/video6.mp4", "videos/education/video7.mp4", "videos/education/video8.mp4",
                "videos/education/video9.mp4", "videos/education/video10.mp4"
            ].map(path => baseUrl + path),
            // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π
        };
        
        let selectedTopics = [];
        let videos = [];
        let currentIndex = 0;
        let coins = 0;
        let currentVideoId = null;
        let coinAwarded = false;

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –º–æ–Ω–µ—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function loadCoins() {
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –∏—Å–ø–æ–ª—å–∑—É–µ–º localStorage, —Ç–∞–∫ –∫–∞–∫ —É –Ω–∞—Å –Ω–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞
            coins = parseInt(localStorage.getItem(`user_${userId}_coins`)) || 0;
            updateCoinDisplay();
        }

        function saveCoins() {
            localStorage.setItem(`user_${userId}_coins`, coins.toString());
        }

        function updateCoinDisplay() {
            document.getElementById('coins').textContent = coins;
        }

        function loadVideos() {
            if (!userId) {
                alert("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –≤–∞—à Telegram ID.");
                return;
            }

            loadCoins();

            if (selectedTopics.length === 0) {
                alert("–í—ã–±–µ—Ä–∏—Ç–µ —Ö–æ—Ç—è –±—ã –æ–¥–Ω—É —Ç–µ–º—É!");
                return;
            }

            videos = selectedTopics.flatMap(topic => videoPaths[topic] || []);
            if (videos.length > 0) {
                shuffleArray(videos);
                playVideo(videos[0]);
            } else {
                alert("–ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∏–¥–µ–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–∏–µ —Ç–µ–º—ã.");
            }
        }

        function nextVideo() {
            if (videos.length === 0) return;
            currentIndex = (currentIndex + 1) % videos.length;
            playVideo(videos[currentIndex]);
        }

        function prevVideo() {
            if (videos.length === 0) return;
            currentIndex = (currentIndex - 1 + videos.length) % videos.length;
            playVideo(videos[currentIndex]);
        }

        function playVideo(videoUrl) {
            const player = document.getElementById('player');
            player.src = videoUrl;
            coinAwarded = false;
            currentVideoId = videoUrl;
            
            player.play().catch(e => console.log("–ê–≤—Ç–æ–≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω–æ:", e));
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ä–µ–º–µ–Ω–∏ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ 50% –≤–∏–¥–µ–æ
            player.ontimeupdate = function() {
                if (!coinAwarded && player.duration > 0 && player.currentTime > player.duration * 0.5) {
                    awardCoin();
                }
            };
            
            // –°–±—Ä–æ—Å –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∏–¥–µ–æ
            player.onended = function() {
                if (!coinAwarded) {
                    awardCoin();
                }
            };
        }

        function awardCoin() {
            coinAwarded = true;
            coins += 1;
            updateCoinDisplay();
            saveCoins();
            
            // –î–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ - –≤ —Ä–µ–∞–ª—å–Ω–æ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –≤—ã–∑–æ–≤ API
            console.log(`–ù–∞—á–∏—Å–ª–µ–Ω–∞ –º–æ–Ω–µ—Ç–∞ –∑–∞ –≤–∏–¥–µ–æ ${currentVideoId}`);
            
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –∞–Ω–∏–º–∞—Ü–∏—é
            const coinElement = document.getElementById('coins');
            coinElement.style.transform = 'scale(1.5)';
            setTimeout(() => {
                coinElement.style.transform = 'scale(1)';
            }, 500);
        }

        function toggleTopic(button) {
            const topic = button.value;
            if (selectedTopics.includes(topic)) {
                selectedTopics = selectedTopics.filter(t => t !== topic);
                button.classList.remove("selected");
            } else {
                selectedTopics.push(topic);
                button.classList.add("selected");
            }
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        tg.ready();
        tg.expand();
    </script>
</body>
</html>
